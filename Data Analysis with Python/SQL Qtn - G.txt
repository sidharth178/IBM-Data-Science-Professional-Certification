Advanced SQL Questions ‚Äî Full Context + Table Columns
1Ô∏è‚É£ Top users per product

Business context:
You work on Google Shopping. The team wants to identify power buyers for each product.

Table: purchases

purchase_id      -- unique transaction id
user_id
product_id
purchase_time    -- timestamp


Question:
For each product, find the top 2 users by total number of purchases.
If there are ties, include all tied users.

2Ô∏è‚É£ User sessions

Business context:
You are analyzing engagement on Google Search.

Table: events

event_id
user_id
event_type       -- click, search, scroll, etc.
event_time       -- timestamp


Question:
Define a session as 30 minutes of inactivity.
For each user:

Number of sessions

Average session duration

3Ô∏è‚É£ Funnel conversion

Business context:
You‚Äôre analyzing an e-commerce funnel.

Table: events

user_id
product_id
event             -- 'view', 'add_to_cart', 'purchase'
event_time


Question:
Calculate how many users complete each funnel step
view ‚Üí add_to_cart ‚Üí purchase in order, and compute conversion rates.

4Ô∏è‚É£ Day-7 retention

Business context:
A feature launched in January 2025 and you want to measure retention.

Table: events

user_id
event_type        -- 'signup', 'login', etc.
event_date        -- DATE (not timestamp)


Question:
Among users who signed up in January 2025, calculate Day-7 retention
(users active exactly 7 days after signup).

5Ô∏è‚É£ Rolling DAU

Business context:
Leadership wants a smoother DAU trend.

Table: daily_activity

activity_date     -- DATE
user_id


Question:
Calculate a 7-day rolling average of Daily Active Users.

6Ô∏è‚É£ Repeat buyers (non-consecutive)

Business context:
Marketing wants consistent buyers, not impulse buyers.

Table: purchases

purchase_id
user_id
purchase_date     -- DATE


Question:
Find users who made more than one purchase, but never on consecutive days.

7Ô∏è‚É£ A/B experiment ARPU

Business context:
You ran an experiment to test a new pricing UI.

Table: experiment_events

user_id
variant            -- 'control', 'treatment'
event_type         -- 'exposure', 'purchase'
revenue            -- NULL if no purchase
event_time


Question:
Compute ARPU per variant, excluding users who were never exposed.

8Ô∏è‚É£ Viewed but not purchased

Business context:
PMs want to identify friction in the purchase flow.

Table: events

user_id
product_id
event              -- 'view', 'purchase'
event_time


Question:
Find users who viewed a product but never purchased that product afterward.

9Ô∏è‚É£ De-duplication

Business context:
User data comes from multiple pipelines and may contain duplicates.

Table: users_raw

user_id
email
updated_at         -- timestamp
source


Question:
Keep only the most recent record per user.

üîü Median session duration

Business context:
You want to compare engagement across platforms.

Table: sessions

session_id
user_id
platform            -- 'web', 'android', 'ios'
session_duration    -- seconds


Question:
Find the median session duration for each platform.

1Ô∏è‚É£1Ô∏è‚É£ First vs later purchase behavior

Business context:
You want to understand spending behavior over time.

Table: purchases

purchase_id
user_id
amount
purchase_time


Question:
Find users whose first purchase amount is greater than the average of their later purchases.

1Ô∏è‚É£2Ô∏è‚É£ Activity streaks

Business context:
Daily engagement streaks indicate habit formation.

Table: daily_activity

user_id
activity_date       -- DATE


Question:
For each user, find their longest consecutive daily activity streak.

1Ô∏è‚É£3Ô∏è‚É£ High-conversion products

Business context:
You want to promote products that convert well.

Table: events

user_id
product_id
event              -- 'view', 'purchase'
event_time


Question:
Find products whose conversion rate is above the platform-wide average.

1Ô∏è‚É£4Ô∏è‚É£ Churn & reactivation

Business context:
Subscription recovery is a key growth lever.

Table: subscriptions

user_id
status              -- 'active', 'churned', 'reactivated'
status_date         -- DATE


Question:
Find users who churned and then reactivated within 30 days of churn.

1Ô∏è‚É£5Ô∏è‚É£ Same action 3 times in a row

Business context:
Trust & Safety suspects automated behavior.

Table: events

user_id
event
event_time


Question:
Find users who performed the same action three times consecutively.

1Ô∏è‚É£6Ô∏è‚É£ Monthly loyal users

Business context:
You‚Äôre identifying high-value loyal users.

Table: purchases

user_id
purchase_date


Question:
Find users who made at least one purchase in every month of 2024.

1Ô∏è‚É£7Ô∏è‚É£ Week-over-week growth

Business context:
Weekly growth metrics are shared with leadership.

Table: daily_activity

activity_date
user_id


Question:
Calculate week-over-week DAU growth rate.

1Ô∏è‚É£8Ô∏è‚É£ Search behavior

Business context:
You‚Äôre analyzing trending searches.

Table: search_logs

user_id
query
search_time         -- timestamp


Question:
For each day, find the most searched query.

1Ô∏è‚É£9Ô∏è‚É£ Funnel drop-off

Business context:
You want to understand where users drop off.

Table: funnel_events

user_id
step                -- 'view', 'add_to_cart', 'purchase'
event_time


Question:
For each funnel step, count how many users reached it.

2Ô∏è‚É£0Ô∏è‚É£ Lifetime revenue

Business context:
Finance wants to track long-term user value.

Table: revenue_events

user_id
revenue
event_time


Question:
For each user, calculate cumulative lifetime revenue over time.